# GSP344 Serverless Firebase Development: Challenge Lab

## Task 1: Create a Firestore database

Navigate to **Firestore**

Create Native Mode in Nam5 (United States)

> Create a Firestore Database

## Task 2: Populate the Database

```bash
git clone https://github.com/rosera/pet-theory.git

cd ~/pet-theory/lab06/firebase-import-csv/solution
npm install
node index.js netflix_titles_original.csv

```

> Populate the Firestore Database

## Task 3: Create a REST API

```bash
cd ~/pet-theory/lab06/firebase-rest-api/solution-01
npm install

gcloud builds submit \
  --tag gcr.io/$GOOGLE_CLOUD_PROJECT/rest-api:0.1

gcloud beta run deploy netflix-dataset-service \
  --image gcr.io/$GOOGLE_CLOUD_PROJECT/rest-api:0.1 \
  --platform managed \
  --region us-central1 \
  --allow-unauthenticated

SERVICE_URL=$(gcloud beta run services describe netflix-dataset-service --platform managed --region us-central1 --format="value(status.url)")

echo $SERVICE_URL

curl -X GET $SERVICE_URL

```

> Deploy and test the REST API

## Task 4: Firestore API access

```bash
cd ~/pet-theory/lab06/firebase-rest-api/solution-02
npm install

gcloud builds submit \
  --tag gcr.io/$GOOGLE_CLOUD_PROJECT/rest-api:0.2

gcloud beta run deploy netflix-dataset-service \
  --image gcr.io/$GOOGLE_CLOUD_PROJECT/rest-api:0.2 \
  --platform managed \
  --region us-central1 \
  --allow-unauthenticated

SERVICE_URL=$(gcloud beta run services describe netflix-dataset-service --platform managed --region us-central1 --format="value(status.url)")

echo $SERVICE_URL

curl -X GET $SERVICE_URL/2019

> Deploy and test the Rest API

## Task 5: Deploy the Staging Frontend

```bash
cd ~/pet-theory/lab06/firebase-frontend

# Assign the value of REST_API_SERVICE to app.js
nano public/app.js

npm install

gcloud builds submit \
  --tag gcr.io/$GOOGLE_CLOUD_PROJECT/frontend-staging:0.1

gcloud beta run deploy frontend-staging-service \
  --image gcr.io/$GOOGLE_CLOUD_PROJECT/frontend-staging:0.1 \
  --platform managed \
  --region us-central1 \
  --allow-unauthenticated

```

> Deploy the staging frontend

## Task 6: Deploy the Production Frontend

```bash

# Assign the value of REST_API_SERVICE to SERVICE_URL/2019 in app.js
nano public/app.js

npm install

gcloud builds submit \
  --tag gcr.io/$GOOGLE_CLOUD_PROJECT/frontend-production:0.1

gcloud beta run deploy frontend-production-service \
  --image gcr.io/$GOOGLE_CLOUD_PROJECT/frontend-production:0.1 \
  --platform managed \
  --region us-central1 \
  --allow-unauthenticated